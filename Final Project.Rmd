---
title: "Final Project"
author: "Alice Huang"
date: "26/03/2023"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Data

# Description of the Data and Problem

In this paper, we propose a Bayesian model for 2019 Carbon Dioxide (CO2) emissions of European countries. The dataset was taken from Kaggle and originally pulled from the US Energy Commission. The original dataset had CO2 emissions data for world countries from 1980-2019, and stratified by energy type. However, we consider just countries from Europe so that the countries are of more comparable geographical size and population. We removed Iceland because there was missing data. We removed Russia because it was an outlier in terms of CO2 emissions. We centered all the covariates, to reduce correlation between variables.


```{r, include=FALSE}
library(tidyverse)
energy <- read.csv("energy.csv")
data2019 <- energy %>% filter(Year == 2019, Energy_type == "all_energy_types") %>% filter(Country != "World")

europe_countries <- c("Armenia", "Albania", "Andorra", "Austria", "Belarus", "Belgium", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Cyprus", "Czech Republic", "Denmark", "Estonia", "Finland", "France", "Germany", "Georgia", "Greece", "Hungary", "Iceland", "Ireland", "Italy", "Kosovo", "Latvia", "Liechtenstein", "Lithuania", "Luxembourg", "Malta", "Moldova", "Monaco", "Montenegro", "Netherlands", "North Macedonia", "Norway", "Poland", "Portugal", "Romania", "Russia", "San Marino", "Serbia", "Slovakia", "Slovenia", "Spain", "Sweden", "Switzerland", "Turkey", "Ukraine", "United Kingdom", "Vatican City")
europe2019 <- data2019 %>% filter(Country %in% europe_countries)

europe2019 %>% filter(Country != "Iceland", Country != "Russia") -> europe2019

# Center variables
europe2019$Energy_consumption = europe2019$Energy_consumption - mean(europe2019$Energy_consumption, na.rm=TRUE)
europe2019$Energy_production = europe2019$Energy_production - mean(europe2019$Energy_production, na.rm=TRUE)
europe2019$GDP = europe2019$GDP - mean(europe2019$GDP, na.rm=TRUE)
europe2019$Population = europe2019$Population - mean(europe2019$Population, na.rm=TRUE)
europe2019$Energy_intensity_per_capita = europe2019$Energy_intensity_per_capita - mean(europe2019$Energy_intensity_per_capita, na.rm=TRUE)
europe2019$Energy_intensity_by_GDP = europe2019$Energy_intensity_by_GDP - mean(europe2019$Energy_intensity_by_GDP, na.rm=TRUE)
```


## Plotting the Covariates Against CO2 Emissions

We noted that generally, as energy production increased, CO2 emissions increased. Similarly, as energy consumption increased, CO2 emissions increased. As population increased, CO2 emissions increased. On the other hand, `Energy_intensity_per_capita` and `Energy intensity_by_GDP` did not seem to significantly influence CO2 emissions. 

```{r}
europe2019 %>% ggplot(aes(col=Energy_production, y=CO2_emission, x=Energy_consumption)) + geom_point() 
```

```{r}
europe2019 %>% ggplot(aes(col=Energy_intensity_by_GDP, y=CO2_emission, x=Energy_production)) + geom_point() 
```

```{r}
europe2019 %>% ggplot(aes(x=Energy_intensity_per_capita, y=CO2_emission, col=Population)) + geom_point() + geom_smooth(method="lm") 
```

```{r}
europe2019 %>% ggplot(aes(x=GDP, y=CO2_emission, col=Energy_intensity_by_GDP)) + geom_point()
```

```{r}
europe2019 %>% ggplot(aes(col=GDP, y=CO2_emission, x=Energy_intensity_by_GDP)) + geom_point()
```

```{r}
europe2019 %>% ggplot(aes(x=Population, y=CO2_emission, col=Energy_intensity_per_capita)) + geom_point()
```

## Checking for Correlation Between Variables

```{r}
m <- as.matrix(cbind(europe2019$Energy_consumption, 
                     europe2019$Energy_production, 
                     europe2019$GDP, 
                     europe2019$Population, 
                     europe2019$Energy_intensity_per_capita, 
                     europe2019$Energy_intensity_by_GDP))
cor(m)
```

```{r}
europe2019 %>% select(Energy_consumption, Energy_production, GDP, Population, Energy_intensity_per_capita, Energy_intensity_by_GDP) -> europe2019filt2
plot(europe2019filt2)
```

There is strong correlation between the following pairs of covariates:

- `Energy_consumption`, `Energy_production`

- `Energy_consumption`, `GDP`

- `Energy_consumption`, `Population`

- `Energy_production`, `Population`

- `Energy_production`, `GDP` 

- `GDP`, `Population`

The correlation between `Energy_consumption`, `GDP` is very close to 1, so we decide to just include `GDP` instead of both variables. Thus we will be interested in the following interactions:

- `Energy_production`, `GDP` 

- `GDP`, `Population`


```{r eval=FALSE, include=FALSE}
europe2019 %>% ggplot(aes(x=Population, y=Energy_intensity_per_capita, col=GDP)) + geom_point()

europe2019 %>% ggplot(aes(x=GDP, y=Energy_intensity_by_GDP, col=Population)) + geom_point()

europe2019 %>% ggplot(aes(x=Population, y=GDP)) + geom_point()

europe2019 %>% ggplot(aes(x=Energy_production, y=Energy_consumption, col=Population)) + geom_point()
```

## Considering What Type of Likelihood Model to Use

The `CO2_emission` histogram is heavily skewed right.

```{r}
europe2019 %>% ggplot(aes(x=CO2_emission)) + geom_histogram()
```

Assuming `CO2_emission` is normally distributed would be inappropriate.

```{r}
qqnorm(europe2019$CO2_emission)
qqline(europe2019$CO2_emission)
```

We consider a log-linear model. We use the Shapiro-Wilk test to test whether `log(CO2_emission)` is normally distributed. The p-value is 0.1566 > 0.05 so we do not reject the null hypothesis that `log(CO2_emission)` is normally distributed. Thus a log-linear model may be a viable option.

```{r}
qqnorm(log(europe2019$CO2_emission))
qqline(log(europe2019$CO2_emission))
shapiro.test(log(europe2019$CO2_emission))
```

We consider a Gamma model. If a Gamma distribution is appropriate for modelling the outcome, the plot of each covariate against the log of the outcome should be linear. Unfortunately, a Gamma model does not appear to be appropriate.

```{r}
europe2019 %>% ggplot(aes(x=Energy_consumption, y=log(CO2_emission))) + geom_point() + geom_smooth(method= "loess")
europe2019 %>% ggplot(aes(x=Energy_production, y=log(CO2_emission))) + geom_point() + geom_smooth(method= "loess")
europe2019 %>% ggplot(aes(x=GDP, y=log(CO2_emission))) + geom_point() + geom_smooth(method= "loess")
europe2019 %>% ggplot(aes(x=Population, y=log(CO2_emission))) + geom_point() + geom_smooth(method= "loess")
```





## Histograms of Covariates For Determining Appropriate Prior Distributions

We see that the covariates' histograms are all heavily skewed to the right.

```{r}
europe2019 %>% ggplot(aes(x=Energy_production)) + geom_histogram(bins=10)
```

```{r}
europe2019 %>% ggplot(aes(x=Population)) + geom_histogram(bins=10)
```

```{r}
europe2019 %>% ggplot(aes(x=GDP)) + geom_histogram(bins=10)
```

## Proposed Model

We propose the following model:

$\log(Y_i) = \beta_0 + \beta_1 P_i + \beta_2 E_i + \beta_3 G_i + \beta_4 E_i G_i + \beta_5 G_i P_i$

where $P_i$ is the population of country $i$, $E_i$ is the energy production of country $i$ and $G_i$ is the GDP of country $i$.

Reference:

https://www.kaggle.com/datasets/lobosi/c02-emission-by-countrys-grouth-and-population
